<html>

<head>
    <title>WebRPC</title>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</head>

<body>
    <h1>Viewer</h1>

    <img id="play">
    <div id="logger"></div>
    <video src="" id="video" style="width: 680px;height: 320px;" autoplay="true"></video>

    <script type="text/javascript">
        var socket = io();
        const peerConnection = new RTCPeerConnection();
        var video = document.getElementById('video');

        socket.on('stream', function (message) {
            peerConnection.setRemoteDescription(message)
                .then(() => peerConnection.createAnswer())
                .then(sdp => peerConnection.setLocalDescription(sdp))
                .then(() => {
                    socket.emit('answer-r', peerConnection.localDescription)
                })
        });

        peerConnection.onaddstream = function (event) {
            video.srcObject = event.stream;
        }
    </script>
</body>

</html>